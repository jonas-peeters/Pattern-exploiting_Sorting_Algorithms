
#include "blockquick.h"
#include "data-random.h"
#include "insertionssort.h"
#include "mergeo.h"
#include "mergeu.h"
#include "minmax.h"
#include "quicko.h"
#include "quickosimd.h"
#include "quickoswap.h"
#include "quicku.h"
#include "swap.h"

#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <unistd.h>

const int DATA_AMOUNT = 2000000;
const int RUNS_PER_BENCH = 1;

void shuffle_data(int data_to_sort[], int size) {
  size_t i;
  for (i = 0; i < size - 1; i++) {
    size_t j = (i + rand()) % size;
    int t = data_to_sort[j];
    data_to_sort[j] = data_to_sort[i];
    data_to_sort[i] = t;
  }
}

void bench(char name[], void (*fun)(int *, int, int), int array_size,
           int data_to_sort[]) {

  // printf("Testing %s with array size %d: ", name, array_size);

  clock_t total = 0;
  int runs = 0;
  while (total < 10000 || runs < 10) {
    runs++;
    shuffle_data(data_to_sort, array_size);
    clock_t start = clock();
    fun(data_to_sort, 0, array_size - 1);
    clock_t stop = clock();
    total += stop - start;

    if (runs == 1 && array_size == 10) {
      printf("\n");
      for (int i = 0; i < array_size; i++) {
        printf("%d ", data_to_sort[i]);
      }
      printf("\n");
    }
  }

  float msec = (float)(total)*1000000 / CLOCKS_PER_SEC / runs;

  printf("%f\t", msec);
}

/*void bench_min_max(int(fun)(int, int)) {

  clock_t total = 0;
  for (int i = 0; i < RUNS_PER_BENCH; i++) {
    clock_t start = clock();
    shuffle_data(10);
    int x = data_to_sort[4];
    int y = data_to_sort[7];
    int z = fun(x, y);
    clock_t stop = clock();
    data_to_sort[2] = z;
    total += stop - start;
  }

  float msec = (float)(total)*1000000 / CLOCKS_PER_SEC / RUNS_PER_BENCH;

  printf("Microseconds: %.3f\n", msec);
}*/

int main() {
  printf("Starting\n");
  int array_sizes[7] = {10, 100, 1000, 10000, 100000, 1000000, 1000000};

  int data_to_sort[DATA_AMOUNT];

  /*bench_min_max(min);
  bench_min_max(min_branchless);
  bench_min_max(max);
  bench_min_max(max_branchless);*/
  printf("Generating random data\n");
  random_data(data_to_sort, DATA_AMOUNT);

  for (int i = 0; i < sizeof array_sizes / sizeof array_sizes[0]; i++) {
    bench("  Quicksort Standard    ", sort_quick_standard, array_sizes[i],
          data_to_sort);
    bench("  Quicksort Optimized   ", sort_quick_optimized, array_sizes[i],
          data_to_sort);
    // bench("  Quicksort SIMD        ", sort_quick_simd, array_sizes[i],
    //       data_to_sort);
    bench("  Quicksort      Swap   ", sort_quick_optimized_swap, array_sizes[i],
          data_to_sort);

    bench("  Block Quicksort       ", sort_quick_block, array_sizes[i],
          data_to_sort);

    bench("  Mergesort Standard    ", sort_merge_standard, array_sizes[i],
          data_to_sort);
    bench("  Mergesort Optimized   ", sort_merge_optimized, array_sizes[i],
          data_to_sort);
    printf("\n");
  }

  /*random_data(data_to_sort, DATA_AMOUNT);

  sort_quick_optimized(data_to_sort, 0, DATA_AMOUNT);

  clock_t total = 0;
  for (int i = 0; i < RUNS_PER_BENCH; i++) {
    shuffle_data(DATA_AMOUNT);
    clock_t start = clock();
    sort_quick_simd(data_to_sort, 0, DATA_AMOUNT);
    clock_t stop = clock();
    total += stop - start;
  }

  float msec = (float)(total)*1000000 / CLOCKS_PER_SEC / RUNS_PER_BENCH;

  printf("%f\t", msec);*/
}
